"use strict";angular.module("angular.extras.number.directives").directive("keyboardNavigation",function(){function a(a,b,c){return a.find("tr:eq("+b+") td:eq("+c+")")}return{restrict:"A",link:function(b,c){function d(b,d){var e=a(c,b,d);if(e.length>0)return m=!1,c.find("td").index(e);for(var f=1;d>=f;f++)if(e=a(c,b,d-f),e.length>0)return m=!0,c.find("td").index(e)}function e(){var a=l-1;return void 0===a||0>a?l:a}function f(){var a=l+1,b=c.find("td").length;return void 0===a||a>b-1?l:a}function g(a,b){var c=d(a+1,b);return m&&(k=b),void 0===c?l:c}function h(a,b){var c=d(a-1,b);return m&&(k=b),void 0===c?l:c}function i(a,b){var d=c.find("td.active-cell"),i=m?k:d.index(),j=d.parent().index();"left"===b?(m=!1,l=e(j,i)):"right"===b?(m=!1,l=f(j,i)):"up"===b?l=h(j,i):"down"===b&&(l=g(j,i))}function j(){c.find(".active-cell input,textarea,select").blur(),c.find(".active-cell").removeClass("active-cell");var a=c.find("tr td:eq("+l+")");a.addClass("active-cell"),a.find("input,textarea,select").focus()}var k,l=0,m=!1,n={};angular.element(document).on("keydown",function(a){var b=a.keyCode;n[b]=!0;var c;37===b||n[16]&&n[9]?c="left":38===b?c="up":39===b||9===b?c="right":40===b&&(c="down"),c&&(a.preventDefault(),i(a,c),j())}).on("keyup",function(a){n[a.keyCode]=!1}),angular.element(document).on("click","td",function(){l=angular.element(this).closest(c).find("td").index(this),m=!1,j()})}}});