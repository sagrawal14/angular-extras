"use strict";angular.module("angular.extras.number.directives").directive("keyboardNavigation",function(){function a(a,b,c){return a.find("tr:eq("+b+") td:eq("+c+")")}return{restrict:"A",link:function(b,c){function d(b,d){var e=a(c,b,d);if(e.length>0)return n=!1,c.find("td").index(e);for(var f=1;d>=f;f++)if(e=a(c,b,d-f),e.length>0)return n=!0,c.find("td").index(e)}function e(){var a=m-1;return void 0===a||0>a?m:a}function f(){var a=m+1,b=c.find("td").length;return void 0===a||a>b-1?m:a}function g(a,b){var c=d(a+1,b);return n&&(l=b),void 0===c?m:c}function h(a,b){var c=d(a-1,b);return n&&(l=b),void 0===c?m:c}function i(a,b){var d=c.find("td.active-cell"),i=n?l:d.index(),j=d.parent().index();"left"===b?(n=!1,m=e(j,i)):"right"===b?(n=!1,m=f(j,i)):"up"===b?m=h(j,i):"down"===b&&(m=g(j,i))}function j(){var a=c.find("td:eq("+m+")");if(a.length){var b=a.offset().top;return window.jQuery&&angular.element("html,body").stop().animate({scrollTop:b-120},400),!1}}function k(){c.find(".active-cell").removeClass("active-cell");var a=c.find("tr td:eq("+m+")");a.addClass("active-cell"),a.find("input,textarea,select").focus(),j()}var l,m=0,n=!1,o={};angular.element(document).on("keydown",function(a){var b=a.keyCode;o[b]=!0;var c;37===b||o[16]&&o[9]?c="left":38===b?c="up":39===b||9===b?c="right":40===b&&(c="down"),c&&(a.preventDefault(),a.stopPropagation(),i(a,c),k())}).on("keyup",function(a){o[a.keyCode]=!1}),angular.element(document).on("click","td",function(){m=angular.element(this).closest(c).find("td").index(this),n=!1,k()})}}});