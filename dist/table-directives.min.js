"use strict";angular.module("angular.extras.core").directive("keyboardNavigation",function(){function a(a,b,c){return a.find("tr:eq("+b+") td:eq("+c+")")}return{restrict:"A",link:function(b,c,d){function e(b,d){var e=a(c,b,d);if(e.length>0)return o=!1,c.find("td").index(e);for(var f=1;d>=f;f++)if(e=a(c,b,d-f),e.length>0)return o=!0,c.find("td").index(e)}function f(){var a=n-1;return void 0===a||0>a?n:a}function g(){var a=n+1,b=c.find("td").length;return void 0===a||a>b-1?n:a}function h(a,b){var c=e(a+1,b);return o&&(m=b),void 0===c?n:c}function i(a,b){var c=e(a-1,b);return o&&(m=b),void 0===c?n:c}function j(a,b){var d=c.find("td.active-cell"),e=o?m:d.index(),j=d.parent().index();"left"===b?(o=!1,n=f(j,e)):"right"===b?(o=!1,n=g(j,e)):"up"===b?n=i(j,e):"down"===b&&(n=h(j,e))}function k(){var a=c.find("td:eq("+n+")");if(a.length){var b=a.offset().top;return window.jQuery&&angular.element("html,body").stop().animate({scrollTop:b-120},400),!1}}function l(){c.find(".active-cell").removeClass("active-cell");var a=c.find("tr td:eq("+n+")");a.addClass("active-cell");var b=a.find("input,textarea,select");0!==b.length?b.focus():angular.element("input,textarea,select").blur(),d.hasOwnProperty("autoScrollToCell")&&k()}var m,n=0,o=!1,p={},q=function(a){var b=a.keyCode;p[b]=!0;var c;37===b||p[16]&&p[9]?c="left":38===b?c="up":39===b||9===b?c="right":40===b&&(c="down"),c&&(a.preventDefault(),a.stopPropagation(),j(a,c),l())},r=function(a){p[a.keyCode]=!1},s=function(){n=angular.element(this).closest(c).find("td").index(this),o=!1,l()};angular.element(document).on("keydown",q).on("keyup",r),angular.element(document).on("click","td",s),b.$on("$destroy",function(){angular.element(document).off("keydown",q).off("keyup",r),angular.element(document).off("click","td",s)})}}});