"use strict";angular.module("angular.extras.number.directives").directive("keyboardNavigation",function(){function a(a,b,c){return a.find("tr:eq("+b+") td:eq("+c+")")}return{restrict:"A",link:function(b,c){function d(b,d){var e=a(c,b,d);if(e.length>0)return c.find("td").index(e);for(var f=1;d>=f;f++)if(e=a(c,b,d-f),e.length>0)return c.find("td").index(e)}function e(a,b){return d(a+1,b)}function f(a,b){return d(a-1,b)}function g(a,b){a.preventDefault();var d=c.find("td.active-cell"),g=d.index(),h=d.parent().index(),j=c.find("td").length,k=0;"left"===b?k=i>0?i-1:i:"right"===b?k=j-1>i?i+1:i:"up"===b?k=f(h,g):"down"===b&&(k=e(h,g)),i=k||i}function h(){c.find(".active-cell input,textarea,select").blur(),c.find(".active-cell").removeClass("active-cell");var a=c.find("tr td:eq("+i+")");a.addClass("active-cell"),a.find("input,textarea,select").focus()}var i=0,j={};angular.element(document).on("keydown",function(a){var b=a.keyCode;j[b]=!0;var c;37===b||j[16]&&j[9]?c="left":38===b?c="up":39===b||9===b?c="right":40===b&&(c="down"),c&&(g(a,c),h())}).on("keyup",function(a){j[a.keyCode]=!1}),angular.element(document).on("click","td",function(){i=angular.element(this).closest(c).find("td").index(this),h()})}}});