"use strict";angular.module("angular.extras.core").directive("keyboardNavigation",function(){function a(a,b,c){return null===b?a.find("tbody tr td:eq("+c+")"):a.find("tbody tr:eq("+b+") td:eq("+c+")")}var b=["input","select","textarea"].join(":not(:disabled):not([readonly]),");return{restrict:"A",scope:!0,link:function(c,d,e){function f(b,c){var e=a(d,b,c);if(e.length>0)return r=!1,d.find("td").index(e);for(var f=1;c>=f;f++)if(e=a(d,b,c-f),e.length>0)return r=!0,d.find("td").index(e)}function g(){var a=p-1;return void 0===a||0>a?p:a}function h(){var a=p+1,b=d.find("td").length;return void 0===a||a>b-1?p:a}function i(a,b){var c=f(a+1,b);return r&&(o=b),void 0===c?p:c}function j(a,b){var c=f(a-1,b);return r&&(o=b),void 0===c?p:c}function k(c,e){var f=a(d,null,p),l=r?o:f.index(),m=f.parent().index();if("left"===e?(r=!1,p=g(m,l)):"right"===e?(r=!1,p=h(m,l)):"up"===e?p=j(m,l):"down"===e&&(p=i(m,l)),s){var t=d.find("td").length,u=a(d,null,p),v=u.find(b);if(0===v.length){var w=q>t;w?(q=0,p=n):(q++,console.log("Recursive call to find the next active cell with any input"),k(c,e))}}}function l(){var b=a(d,null,p);if(b.length){var c=b.offset().top;return window.jQuery&&angular.element("html,body").stop().animate({scrollTop:c-120},400),!1}}function m(){q=0,d.find(".active-cell").removeClass("active-cell");var b=a(d,null,p);b.addClass("active-cell");var c=b.find("input,textarea,select");0!==c.length?(c.focus(),n=p):angular.element("input,textarea,select").blur(),e.hasOwnProperty("autoScrollToCell")&&l()}var n,o,p=0,q=0,r=!1,s=void 0===e.autoScrollToCell||e.autoScrollToCell===!0,t={},u=function(a){var b=a.keyCode;t[b]=!0;var c;37===b||t[16]&&t[9]?c="left":38===b?c="up":39===b||9===b?c="right":40!==b&&13!==b||(c="down"),c&&(a.preventDefault(),a.stopPropagation(),k(a,c),m())},v=function(a){t[a.keyCode]=!1},w=function(){p=angular.element(this).closest(d).find("td").index(this),r=!1,m()},x=s?d:document;angular.element(x).on("keydown",u).on("keyup",v),angular.element(d).on("click","td",w),c.$on("$destroy",function(){angular.element(x).off("keydown",u).off("keyup",v),angular.element(d).off("click","td",w)})}}});